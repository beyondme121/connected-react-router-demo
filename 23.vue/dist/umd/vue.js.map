{"version":3,"file":"vue.js","sources":["../../src/observer/array.js","../../src/utils.js","../../src/observer/dep.js","../../src/observer/index.js","../../src/state.js","../../src/compiler/parse.js","../../src/compiler/generate.js","../../src/compiler/index.js","../../src/vdom/patch.js","../../src/observer/watcher.js","../../src/lifecycle.js","../../src/init.js","../../src/vdom/index.js","../../src/global-api/index.js","../../src/index.js"],"sourcesContent":["// 拿到Array的原型对象\r\nlet oldArrayProtoMethods = Array.prototype\r\n\r\n// 根据Array的原型创建对象\r\nexport let arrayMethods = Object.create(oldArrayProtoMethods)\r\n\r\n// 需要重写数组的方法(可以改变数组的方法)\r\nlet methods = [\r\n  'push',\r\n  'pop',\r\n  'shift',\r\n  'unshift',\r\n  'reverse',\r\n  'sort',\r\n  'splice'\r\n]\r\n\r\nmethods.forEach(method => {\r\n  // 重新定义数组的方法, 重写上面的7个方法\r\n  arrayMethods[method] = function (...args) {\r\n    // 切面编程: 做点特殊的事情之后, 再调用原本执行的方法\r\n    // console.log('数组方法重写了，更新视图')\r\n    // 原本的方法执行\r\n    const result = oldArrayProtoMethods[method].apply(this, arguments)\r\n    let inserted;\r\n    let ob = this.__ob__    // 通过属性的__ob__属性可以拿到Observer实例, 通过实例可以拿到实例方法\r\n    // 监控新增对象\r\n    switch (method) {\r\n      case 'push':\r\n      case 'unshift':   // 这两个方法都是追加 追加的内容可能是对象类型，应该被再次进行劫持\r\n        inserted = args\r\n        break;\r\n      case 'splice':\r\n        inserted = args.slice(2)  // arr.splice(0, 1, {a: 100}) // 数组下标0的位置 删除1个, 并用对象{a: 100}填补这个位置 => 新增\r\n      default:\r\n        break;\r\n    }\r\n    // 将观测对象的方法, 挂载到实例的属性__ob__上\r\n    // if (inserted) ob.observeArray(inserted)\r\n    if (inserted) {\r\n      ob.observeArray(inserted)\r\n    }\r\n    return result\r\n  }\r\n})","export function proxy(vm, data, key) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      return vm[data][key]\r\n    },\r\n    set(newValue) {\r\n      vm[data][key] = newValue\r\n    }\r\n  })\r\n}\r\n\r\n// 对目标对象定义属性, 属性是不可枚举的\r\nexport function definePropertyWithoutEnumerable(target, key, value) {\r\n  Object.defineProperty(target, key, {\r\n    enumerable: false,\r\n    configurable: false,\r\n    value\r\n  })\r\n}\r\n\r\n\r\nexport const LIFECYCLE_HOOKS = [\r\n  'beforeCreate',\r\n  'created',\r\n  'beforeMount',\r\n  'mounted',\r\n  'beforeUpdate',\r\n  'updated',\r\n  'beforeDestroy',\r\n  'destroyed'\r\n]\r\nconst strategy = {}\r\nfunction mergeHook(parentVal, childVal) {\r\n  if (childVal) {\r\n    if (parentVal) {\r\n      return parentVal.concat(childVal)   // 父子拼接, 多个mixin配置中, 多次出现created, 那么把多个方法放进去\r\n    } else {\r\n      return [childVal]\r\n    }\r\n  } else {\r\n    return parentVal\r\n  }\r\n}\r\nLIFECYCLE_HOOKS.forEach(hook => strategy[hook] = mergeHook)\r\n\r\n// 合并选项 parent: Vue.options={}, child: mixin = { created: fn }\r\nexport function mergeOptions(parent, child) {\r\n  const options = {}\r\n  for (let key in parent) {\r\n    mergeField(key)\r\n  }\r\n\r\n  // 儿子有,父亲没有, 把儿子多的属性合并到父亲上\r\n  for (let key in child) {\r\n    if (!parent.hasOwnProperty(key)) {\r\n      mergeField(key)\r\n    }\r\n  }\r\n\r\n  // 合并生命周期的钩子hook, 如created\r\n  function mergeField(key) {\r\n    if (strategy[key]) {\r\n      options[key] = strategy[key](parent[key], child[key])\r\n    } else {\r\n      options[key] = child[key]\r\n    }\r\n  }\r\n\r\n  return options\r\n}","let id = 0\r\nclass Dep {\r\n  constructor() {\r\n    this.subs = []\r\n    this.id = id++\r\n  }\r\n\r\n  depend() {\r\n    // this.subs.push(Dep.target)\r\n    Dep.target.addDep(this)\r\n  }\r\n\r\n  addSub(watcher) {\r\n    this.subs.push(watcher)\r\n  }\r\n  // 数据变更, 让所有的watcher调用自己的update方法, watcher敞开方法供dep调用\r\n  notify() {\r\n    this.subs.forEach(watcher => watcher.update())\r\n  }\r\n}\r\n\r\n\r\n// 属性依赖dep 要记住 在哪个watcher中使用了，也就是属性在哪个组件中\r\nexport function pushTarget(watcher) {\r\n  Dep.target = watcher\r\n}\r\n\r\nexport function popTarget() {\r\n  Dep.target = null\r\n}\r\n\r\n\r\nexport default Dep","import { arrayMethods } from \"./array\"\r\nimport { definePropertyWithoutEnumerable } from \"../utils\"\r\nimport Dep from \"./dep\"\r\n\r\n\r\nclass Observer {\r\n  constructor(value) {\r\n    definePropertyWithoutEnumerable(value, '__ob__', this)  // this: Observer实例\r\n    // value.__ob__ = this\r\n\r\n    // 如果是数组, 不观测每一项\r\n    if (Array.isArray(value)) {\r\n      // value如果是数组, 继承指向重新的数组方法，通过原型链继承\r\n      value.__proto__ = arrayMethods\r\n      this.observeArray(value)\r\n    } else {\r\n      this.walk(value)\r\n    }\r\n  }\r\n\r\n  // 观测数组中的每一项, 如果是对象就进行观测\r\n  observeArray(value) {\r\n    value.forEach(item => {\r\n      // 观测数组中的对象类型\r\n      observe(item)\r\n    })\r\n  }\r\n\r\n  walk(data) {\r\n    let keys = Object.keys(data)\r\n    keys.forEach(key => {\r\n      defineReactive(data, key, data[key])\r\n    })\r\n  }\r\n}\r\n\r\nfunction defineReactive(data, key, value) {\r\n  // 递归观察data嵌套的对象\r\n  observe(value)\r\n  // 每个属性一个dep\r\n  let dep = new Dep()\r\n\r\n  Object.defineProperty(data, key, {\r\n    get() {\r\n      if (Dep.target) {\r\n        dep.depend()\r\n      }\r\n      return value\r\n    },\r\n    set(newValue) {\r\n      if (newValue === value) return\r\n      console.log('数据设置了')\r\n      // 如果给data属性设置一个对象,设置的对象也需要进行观测\r\n      observe(newValue)\r\n      value = newValue\r\n\r\n      // 数据变更, 通知dep中的所有watcher调用自己的更新\r\n      dep.notify()\r\n    }\r\n  })\r\n}\r\n\r\n// 观测数据的变化, 更新视图\r\nexport function observe(data) {\r\n  if (data.__ob__) {\r\n    return data\r\n  }\r\n  // 只观测对象或数组\r\n  if (typeof data !== 'object' || data == null) {\r\n    return\r\n  }\r\n  // 使用类的方式: 1. 可以清楚的知道这个属性是哪个类的实例 2. 观测数据的功能是高内聚的\r\n  return new Observer(data)\r\n}","import { observe } from \"./observer/index.js\"\r\nimport { proxy } from \"./utils.js\"\r\n\r\nexport function initState(vm) {\r\n  const opts = vm.$options\r\n  // 根据不同的选项, 做不同的拆分处理, data如何处理, props如何处理等\r\n  if (opts.props) {\r\n    initProps(vm)\r\n  }\r\n  if (opts.data) {\r\n    initData(vm)\r\n  }\r\n}\r\n\r\nfunction initProps() { }\r\n\r\n// data数据的初始化操作, 数据劫持\r\nfunction initData(vm) {\r\n  let data = vm.$options.data\r\n  // data可能是函数, 也可能是对象, 函数就直接执行,结果返回对象,赋值给vm也是为了可以通过vue实例获取到数据劫持后的数据(引用)\r\n  vm._data = data = typeof data === 'function' ? data.call(vm) : data\r\n\r\n  // 当我去vm上取属性时 ，帮我将属性的取值代理到vm._data上\r\n  for (let key in data) {\r\n    proxy(vm, '_data', key)\r\n  }\r\n  observe(data)\r\n}","const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`; // 标签名 ?:匹配不捕获\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`; // </my:xx>\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 标签开头的正则 捕获的内容是标签名\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配标签结尾的 </div>\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 匹配属性的    aaa=\"aaa\"  a='aaa'   a=aaa\r\nconst startTagClose = /^\\s*(\\/?)>/; // 匹配标签结束的 >    >   <div></div>  <br/>\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;\r\n\r\nexport function parseHTML(html) {\r\n  // 解析开始标签 <div id=\"app\" name=\"xxx\">\r\n  function parseStartTag() {\r\n    const start = html.match(startTagOpen)\r\n    // start[0] => \"<div\"\r\n    if (start) {\r\n      // 保存标签和属性\r\n      const match = {\r\n        tagName: start[1],      // start[1] ==> div\r\n        attrs: []\r\n      }\r\n      // 匹配完了就要删除\r\n      advance(start[0].length)   // 删除html开始标签 start[0] ==> <div\r\n\r\n      let end, attr\r\n      // 处理开始标签的属性 如果没有遇到结束标签的标识符\">\", 并且匹配到了属性, 就将匹配到的attr保存到match对象上, 最终return\r\n      while (!(end = html.match(startTagClose)) && (attr = html.match(attribute))) {\r\n        match.attrs.push({\r\n          name: attr[1],      // id\r\n          value: attr[3] || attr[4] || attr[5]    // app\r\n        })\r\n        // 匹配完继续删除\r\n        advance(attr[0].length)\r\n      }\r\n      // 最终就剩下 \">\"\r\n      if (end) {\r\n        advance(end[0].length)\r\n        return match\r\n      }\r\n    }\r\n  }\r\n\r\n  function advance(n) {\r\n    html = html.substring(n)\r\n  }\r\n\r\n  let root;\r\n  let currentParent;    // 父节点\r\n  let stack = []        // 用于校验html标签书写是否规范, 标签是否配对, 开始标签存入栈中, 遇到结束标签 pop, \r\n\r\n  // 处理开始\r\n  function start(tagName, attrs) {\r\n    // console.log(tagName, attrs)\r\n    let element = createASTElement(tagName, attrs)\r\n    // 因为创建的是树tree,只能由一个根root\r\n    if (!root) {\r\n      root = element\r\n    }\r\n    currentParent = element   // 解析的当前节点作为 下一次解析文本的父级元素 例如 <div id=\"app\">hello</div>, <div id=\"app\">生成的 AST对象就是hello的父级currentParent\r\n    stack.push(element)\r\n    // console.log(\"stack: \", stack)\r\n  }\r\n\r\n  // 处理文本\r\n  function chars(text) {\r\n    // console.log(text)\r\n    // 文本可能是空文本\r\n    // text = text.replace(/\\s/g, '')\r\n    text = text.trim()\r\n    if (text) {\r\n      currentParent.children.push({\r\n        type: 3,\r\n        text\r\n      })\r\n    }\r\n  }\r\n\r\n  // 结束标签处理 </div>\r\n  // 1. 记录结束标签的父亲\r\n  // 2. 当前标签父亲的儿子是谁\r\n  // 3. 结束标签建立父子关系 \r\n  function end(tagName) {\r\n    // console.log(\"end....\", tagName)\r\n    let ele = stack.pop()   // 取出栈中的最后一个\r\n    // console.log(\"ele,\", ele)\r\n    // if (tagName === ele.tag) {\r\n    //   console.log('tagName,  ele.tagName', tagName, ele.tag)\r\n    // } else {\r\n    //   console.log('------> tagName,  ele.tagName', tagName, ele.tag)\r\n    // }\r\n    currentParent = stack[stack.length - 1]\r\n    if (currentParent) {\r\n      ele.parent = currentParent\r\n      currentParent.children.push(ele)\r\n    }\r\n  }\r\n\r\n  // 生成AST\r\n  function createASTElement(tagName, attrs) {\r\n    return {\r\n      tag: tagName, // 标签名\r\n      type: 1, // 元素类型\r\n      children: [], // 孩子列表\r\n      attrs, // 属性集合\r\n      parent: null // 父元素\r\n    }\r\n  }\r\n\r\n\r\n  while (html) {\r\n    // debugger\r\n    // 查找到 \"<\"\r\n    let textEnd = html.indexOf('<')\r\n    if (textEnd == 0) {   // 肯定是标签, 要么是<div> 开始标签, 要么是结束标签</div>\r\n      // 解析匹配开始标签\r\n      const startTagMatch = parseStartTag()\r\n      if (startTagMatch) {\r\n        start(startTagMatch.tagName, startTagMatch.attrs)   // start函数内调用创建ast树的方法\r\n        // 继续处理(处理文本或者结束标签)\r\n        continue\r\n      }\r\n      // 匹配上 < 也可能是结束标签, 此处用html.match, 因为html已经在上面的parseStartTag中,如果匹配了就已经截取删除了\r\n      // 如果是结束标签, \r\n      const endTagMatch = html.match(endTag)\r\n      if (endTagMatch) {\r\n        advance(endTagMatch[0].length)      // <div>\r\n        end(endTagMatch[1])    // 将结束标签传入 \r\n        continue\r\n      }\r\n    }\r\n    // 如果是文本保存并\r\n    let text\r\n    if (textEnd > 0) {\r\n      text = html.substring(0, textEnd)\r\n    }\r\n    // 截取删除\r\n    if (text) {\r\n      advance(text.length)\r\n      chars(text)     // 处理文本 hello {{name}}\r\n    }\r\n    // break;\r\n  }\r\n\r\n  return root;\r\n}","\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;\r\n\r\nfunction genProps(attrs) {\r\n  let str = ''\r\n  for (let i = 0; i < attrs.length; i++) {\r\n    const attr = attrs[i];\r\n    if (attr.name === 'style') {\r\n      let obj = {}\r\n      attr.value.split(';').forEach(_item => {\r\n        let [key, value] = _item.split(':')\r\n        obj[key] = value\r\n      })\r\n      attr.value = obj\r\n    }\r\n    str += `${attr.name}:${JSON.stringify(attr.value)},`\r\n  }\r\n  return `{${str.slice(0, -1)}}`\r\n  // _c(div, {id:\"app\",style:{\"color\":\"red\",\" fontSize\":\" 16px\"}})\r\n}\r\n\r\n\r\nfunction gen(node) {\r\n  if (node.type === 1) {\r\n    return generate(node)   // 生产元素节点的字符串\r\n  } else {\r\n    let text = node.text\r\n    if (!defaultTagRE.test(text)) {\r\n      return `_v(${JSON.stringify(text)})`\r\n    }\r\n    let tokens = []\r\n    let lastIndex = defaultTagRE.lastIndex = 0\r\n    let match, index\r\n\r\n    while (match = defaultTagRE.exec(text)) {\r\n      index = match.index\r\n      if (index > lastIndex) {\r\n        tokens.push(JSON.stringify(text.slice(lastIndex, index)))   // 匹配开始的下表 截取匹配字符串的长度\r\n      }\r\n      // 匹配变量\r\n      tokens.push(`_s(${match[1].trim()})`)\r\n      lastIndex = index + match[0].length\r\n    }\r\n    // 如果是这种情况 hello {{name}} world {{age}} xxx, 需要把xxx加入到token中, 作为_v\r\n    if (lastIndex < text.length) {\r\n      tokens.push(JSON.stringify(text.slice(lastIndex)))\r\n    }\r\n    return `_v(${tokens.join('+')})`;\r\n  }\r\n}\r\n\r\nfunction genChildren(ast) {\r\n  const children = ast.children\r\n  if (children) {\r\n    return children.map(child => gen(child)).join(',')\r\n  }\r\n}\r\n\r\nexport function generate(ast) {\r\n  let children = genChildren(ast)  // 生成儿子\r\n  // `,${children}` 前面的, 要注意细节\r\n  let code = `_c('${ast.tag}', ${ast.attrs.length > 0 ? `${genProps(ast.attrs)}` : 'undefined'} ${children ? `,${children}` : ''})`\r\n  // console.log(\"code: \", code)\r\n  return code\r\n}","import { parseHTML } from \"./parse\";\r\nimport { generate } from \"./generate\";\r\n\r\nexport function compileToFunctions(template) {\r\n  // 将模板字符串解析成AST语法树\r\n  let ast = parseHTML(template)\r\n  // 静态代码优化\r\n  // 代码生成: 根据ast树生成render方法\r\n  let code = generate(ast)\r\n  let render = new Function(`with(this) { return ${code}}`)\r\n  // 将字符串变成函数 限制取值范围 通过with来进行取值 稍后调用render函数就可以通过改变this 让这个函数内部取到结果了\r\n  // let render = new Function(`with(this) { return ${code} }`)\r\n  return render\r\n}","export function patch(oldDOMNode, vnode) {\r\n  // 将虚拟节点转化成真实节点\r\n  let el = createElm(vnode); // 产生真实的dom \r\n  let parentElm = oldDOMNode.parentNode; // 获取老的app的父亲 =》 body\r\n  parentElm.insertBefore(el, oldDOMNode.nextSibling); // 当前的真实元素插入到app的后面\r\n  // parentElm.insertBefore(el, oldDOMNode)\r\n  parentElm.removeChild(oldDOMNode); // 删除老的节点\r\n  // 把创建的DOM返回\r\n  return el\r\n}\r\n\r\nfunction createElm(vnode) {\r\n  let { tag, children, key, data, text } = vnode;\r\n  if (typeof tag == 'string') { // 创建元素 放到vnode.el上\r\n    // 创建DOM\r\n    vnode.el = document.createElement(tag);\r\n    // 更新属性\r\n    updateProperties(vnode)\r\n\r\n    children.forEach(child => { // 遍历儿子 将儿子渲染后的结果扔到父亲中\r\n      vnode.el.appendChild(createElm(child));\r\n    })\r\n  } else { // 创建文件 放到vnode.el上\r\n    vnode.el = document.createTextNode(text);\r\n  }\r\n  return vnode.el;\r\n}\r\n\r\n// 根据虚拟节点的data属性, 更新DOM的attrs\r\nfunction updateProperties(vnode) {\r\n  let el = vnode.el\r\n  let newProps = vnode.data || {}\r\n  for (let key in newProps) {\r\n    if (key === 'style') {\r\n      // style属性是个对象\r\n      for (let styleName in newProps.style) {\r\n        el.style[styleName] = newProps.style[styleName]\r\n      }\r\n    } else if (key === 'class') {\r\n      el.className = el.class\r\n    } else {\r\n      el.setAttribute(key, newProps[key])\r\n    }\r\n  }\r\n}","import { pushTarget, popTarget } from \"./dep\"\r\n\r\nlet id = 0\r\nclass Watcher {\r\n  /**\r\n   * @param {*} vm \r\n   * @param {*} exprOrFn: 可能是表达式 Vue.$set这种更新数据; 也可能是函数, 直接调用update(render)\r\n   * @param {*} updateCallback: 更新后的callback\r\n   * @param {*} options: 包含了是否为渲染watcher\r\n   */\r\n  constructor(vm, exprOrFn, updateCallback, options) {\r\n    this.vm = vm\r\n    this.exprOrFn = exprOrFn\r\n    this.updateCallback = updateCallback\r\n    this.options = options\r\n    this.deps = []\r\n    this.depsId = new Set()\r\n    this.id = id++\r\n    if (typeof exprOrFn === 'function') {\r\n      this.getter = exprOrFn\r\n    }\r\n    this.get()\r\n  }\r\n\r\n  // watcher记录dep\r\n  addDep(dep) {\r\n    // this.deps.push(dep)\r\n    let id = dep.id\r\n    if (!this.depsId.has(id)) {\r\n      this.deps.push(dep)\r\n      this.depsId.add(id)\r\n      dep.addSub(this)\r\n    }\r\n  }\r\n\r\n  get() {\r\n    pushTarget(this)    // 把watcher实例给到Dep类去折腾. 在Dep.target = this\r\n    // 渲染页面(1. 代码生成render 2. 生成DOM,挂载页面)\r\n    this.getter()\r\n    popTarget()\r\n  }\r\n\r\n  update() {\r\n    this.get()\r\n  }\r\n}\r\n\r\nexport default Watcher","// 生命周期也是一个插件, 需要在Vue实例的原型上挂载更新与render方法\r\n\r\nimport { patch } from \"./vdom/patch\"\r\nimport Watcher from \"./observer/watcher\"\r\n\r\nexport function mountComponent(vm, el) {\r\n  callHook(vm, 'beforeMount')\r\n  // 1. 生成虚拟DOM => vm._render() 2. 渲染真实节点vm._update\r\n  // 都是vm实例上的方法, render和update都是组件生命周期的一部分, 抽离成一个lifecycle文件转换处理生命周期, 理念上与初始化平级别 init - lifecycle\r\n  // vm._update(vm._render())\r\n\r\n  const updateComponent = () => {\r\n    vm._update(vm._render())\r\n  }\r\n  const updateCallback = () => { }\r\n  const isRenderWatcher = true\r\n\r\n  let watcher = new Watcher(vm, updateComponent, updateCallback, isRenderWatcher)\r\n\r\n  // setTimeout(() => {\r\n  //   watcher.get()\r\n  // }, 1000);\r\n\r\n  callHook(vm, 'mounted')\r\n}\r\n\r\nexport function lifecycleMixin(Vue) {\r\n  // 渲染页面\r\n  Vue.prototype._update = function (vdom) {\r\n    const vm = this\r\n    vm.$el = patch(vm.$el, vdom)    // 新的vdom, 生成新的DOM, 替换掉老的DOM vm.$el, 然后返回这个新的DOM, 赋值给实例属性上 vm.$el\r\n  }\r\n  // 生成虚拟DOM\r\n  Vue.prototype._render = function () {\r\n    const vm = this\r\n    let render = vm.$options.render\r\n    // 调用vm.$options.render方法, new Function(`with(this) { return ${code}}`)\r\n    // 因为render方法的字符串表示中有类似 _c, _v这种函数调用, 作用域(通过with)指向了this, call(vm), 那么this就是vm. 实例上的方法, 原型方法, \r\n    let vdom = render.call(vm)\r\n    // console.log(\"vdom,\", vdom)\r\n    return vdom\r\n  }\r\n}\r\n\r\nexport function callHook(vm, hook) {\r\n  const handlers = vm.$options[hook]    // vm.$options[hook] = vm.$options.created = [a,b,created,...]\r\n  if (handlers) {\r\n    for (let i = 0; i < handlers.length; i++) {\r\n      handlers[i].call(vm)\r\n    }\r\n  }\r\n}","import { initState } from \"./state\"\r\nimport { compileToFunctions } from \"./compiler/index.js\"\r\nimport { mountComponent, callHook } from './lifecycle'\r\nimport { mergeOptions } from \"./utils\"\r\n\r\n// 初始化\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function (options) {\r\n    // 选项挂载到vue实例上\r\n    const vm = this\r\n    vm.$options = mergeOptions(vm.constructor.options, options)\r\n    // console.log(vm.$options)\r\n\r\n    callHook(vm, 'beforeCreate')\r\n    // 初始化中一个个不同的功能\r\n    // 1. 数据的初始化: 初始化状态, 数据响应式, 数据变更, 视图更新, 数据劫持\r\n    initState(vm)\r\n\r\n    callHook(vm, 'created')\r\n    // 2. 初始化事件\r\n    // 3. 数据渲染到页面\r\n    // 如果有el属性, 说明需要渲染页面\r\n    if (vm.$options.el) {\r\n      vm.$mount(vm.$options.el)\r\n    }\r\n  }\r\n\r\n  Vue.prototype.$mount = function (el) {\r\n    // debugger\r\n    const vm = this\r\n    el = document.querySelector(el)\r\n    vm.$el = el\r\n    const options = vm.$options\r\n    if (!options.render) {\r\n      let template = options.template\r\n      if (!template && el) {\r\n        template = el.outerHTML\r\n      }\r\n      // 将模板编译成render函数\r\n      const render = compileToFunctions(template)\r\n      options.render = render\r\n    }\r\n    // 挂载组件 属于生命周期的一部分 (创建VDOM和渲染真实节点的开始 vm上有render, el是被替换的DOM节点)\r\n    // debugger\r\n    mountComponent(vm, el)\r\n  }\r\n}","export function renderMixin(Vue) {\r\n  // 生成虚拟DOM\r\n  // _c(div, {id:\"app\",style:{\"color\":\"red\"}} ,_c(p, undefined ,_v(\"hello world zf\"+_s(school.name))))\r\n  Vue.prototype._c = function () {  // 创建虚拟dom元素\r\n    return createElement(...arguments)\r\n  }\r\n\r\n  // 创建虚拟dom文本元素\r\n  Vue.prototype._v = function (text) {\r\n    return createTextVnode(text);\r\n  }\r\n  // stringify\r\n  Vue.prototype._s = function (val) {\r\n    // console.log('_s: val', val, typeof val)\r\n    return val === null ? '' : typeof val === 'object' ? JSON.stringify(val) : val\r\n  }\r\n}\r\n\r\n// 其实还是根据ast对象树 生成vdom\r\nfunction createElement(tag, data = {}, ...children) {\r\n  return vnode(tag, data, data.key, children)\r\n}\r\n\r\nfunction createTextVnode(text) {\r\n  return vnode(undefined, undefined, undefined, undefined, text)\r\n}\r\n\r\n// 用来产生虚拟dom的\r\nfunction vnode(tag, data, key, children, text) {\r\n  return {\r\n    tag, data, key, children, text\r\n  }\r\n}","import { mergeOptions } from \"../utils\"\r\n\r\nexport function initGlobalApi(Vue) {\r\n  Vue.options = {}\r\n  Vue.mixin = function (mixin) {\r\n    // debugger\r\n    this.options = mergeOptions(this.options, mixin)\r\n  }\r\n}","import { initMixin } from \"./init\"\r\nimport { lifecycleMixin } from \"./lifecycle\"\r\nimport { renderMixin } from \"./vdom/index\"\r\nimport { initGlobalApi } from \"./global-api/index\"\r\n\r\nfunction Vue(options) {\r\n  this._init(options)\r\n}\r\n\r\n// 扩展原型\r\n// 初始化方法\r\ninitMixin(Vue)\r\nlifecycleMixin(Vue)\r\nrenderMixin(Vue)\r\n\r\n// 扩展Vue静态方法\r\ninitGlobalApi(Vue)\r\n\r\nexport default Vue"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","result","apply","arguments","inserted","ob","__ob__","slice","observeArray","proxy","vm","data","key","defineProperty","get","set","newValue","definePropertyWithoutEnumerable","target","value","enumerable","configurable","LIFECYCLE_HOOKS","strategy","mergeHook","parentVal","childVal","concat","hook","mergeOptions","parent","child","options","mergeField","hasOwnProperty","id","Dep","subs","addDep","watcher","push","update","pushTarget","popTarget","Observer","isArray","__proto__","walk","item","observe","keys","defineReactive","dep","depend","console","log","notify","initState","opts","$options","props","initData","_data","call","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","parseHTML","html","parseStartTag","start","match","tagName","attrs","advance","length","end","attr","name","n","substring","root","currentParent","stack","element","createASTElement","chars","text","trim","children","type","ele","pop","tag","textEnd","indexOf","startTagMatch","endTagMatch","defaultTagRE","genProps","str","i","obj","split","_item","JSON","stringify","gen","node","generate","test","tokens","lastIndex","index","exec","join","genChildren","ast","map","code","compileToFunctions","template","render","Function","patch","oldDOMNode","vnode","el","createElm","parentElm","parentNode","insertBefore","nextSibling","removeChild","document","createElement","updateProperties","appendChild","createTextNode","newProps","styleName","style","className","setAttribute","Watcher","exprOrFn","updateCallback","deps","depsId","Set","getter","has","add","addSub","mountComponent","callHook","updateComponent","_update","_render","isRenderWatcher","lifecycleMixin","Vue","vdom","$el","handlers","initMixin","_init","constructor","$mount","querySelector","outerHTML","renderMixin","_c","_v","createTextVnode","_s","val","undefined","initGlobalApi","mixin"],"mappings":"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"}