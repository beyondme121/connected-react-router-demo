{"version":3,"file":"vue.js","sources":["../../src/observer/array.js","../../src/utils.js","../../src/observer/dep.js","../../src/observer/index.js","../../src/observer/watcher.js","../../src/state.js","../../src/compiler/parse.js","../../src/compiler/generate.js","../../src/compiler/index.js","../../src/vdom/patch.js","../../src/lifecycle.js","../../src/init.js","../../src/vdom/index.js","../../src/global-api/index.js","../../src/index.js"],"sourcesContent":["// 拿到Array的原型对象\r\nlet oldArrayProtoMethods = Array.prototype\r\n\r\n// 根据Array的原型创建对象\r\nexport let arrayMethods = Object.create(oldArrayProtoMethods)\r\n\r\n// 需要重写数组的方法(可以改变数组的方法)\r\nlet methods = [\r\n  'push',\r\n  'pop',\r\n  'shift',\r\n  'unshift',\r\n  'reverse',\r\n  'sort',\r\n  'splice'\r\n]\r\n\r\nmethods.forEach(method => {\r\n  // 重新定义数组的方法, 重写上面的7个方法\r\n  arrayMethods[method] = function (...args) {\r\n\r\n    // console.log(args)\r\n    // 切面编程: 做点特殊的事情之后, 再调用原本执行的方法\r\n    // console.log('数组方法重写了，更新视图')\r\n    // 原本的方法执行\r\n    const result = oldArrayProtoMethods[method].apply(this, arguments)\r\n    let inserted;\r\n    let ob = this.__ob__    // 通过属性的__ob__属性可以拿到Observer实例, 通过实例可以拿到实例方法\r\n    // 监控新增对象\r\n    switch (method) {\r\n      case 'push':\r\n      case 'unshift':   // 这两个方法都是追加 追加的内容可能是对象类型，应该被再次进行劫持\r\n        inserted = args\r\n        break;\r\n      case 'splice':\r\n        inserted = args.slice(2)  // arr.splice(0, 1, {a: 100}) // 数组下标0的位置 删除1个, 并用对象{a: 100}填补这个位置 => 新增\r\n      default:\r\n        break;\r\n    }\r\n    // 将观测对象的方法, 挂载到实例的属性__ob__上\r\n    // if (inserted) ob.observeArray(inserted)\r\n    if (inserted) {\r\n      ob.observeArray(inserted)\r\n    }\r\n    // 通过observer实例获取dep\r\n    ob.dep.notify()  // 通知数组更新\r\n    return result\r\n  }\r\n})","export function proxy(vm, data, key) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      return vm[data][key]\r\n    },\r\n    set(newValue) {\r\n      vm[data][key] = newValue\r\n    }\r\n  })\r\n}\r\n\r\n// 对目标对象定义属性, 属性是不可枚举的\r\nexport function definePropertyWithoutEnumerable(target, key, value) {\r\n  Object.defineProperty(target, key, {\r\n    enumerable: false,\r\n    configurable: false,\r\n    value\r\n  })\r\n}\r\n\r\n\r\nexport const LIFECYCLE_HOOKS = [\r\n  'beforeCreate',\r\n  'created',\r\n  'beforeMount',\r\n  'mounted',\r\n  'beforeUpdate',\r\n  'updated',\r\n  'beforeDestroy',\r\n  'destroyed'\r\n]\r\nconst strategy = {}\r\n\r\n// 状态state合并 TODO\r\n// 合并data, 不能这样简单的取儿子的属性值\r\n// strategy.data = function (parentVal, childValue) {\r\n//   return childValue\r\n// }\r\n// strategy.computed = function () {\r\n\r\n// }\r\n// strategy.watch = function () {\r\n\r\n// }\r\n\r\n\r\n\r\n\r\nfunction mergeHook(parentVal, childVal) {\r\n  if (childVal) {\r\n    if (parentVal) {\r\n      return parentVal.concat(childVal)   // 父子拼接, 多个mixin配置中, 多次出现created, 那么把多个方法放进去\r\n    } else {\r\n      return [childVal]\r\n    }\r\n  } else {\r\n    return parentVal\r\n  }\r\n}\r\nLIFECYCLE_HOOKS.forEach(hook => strategy[hook] = mergeHook)\r\n\r\n// 合并选项 parent: Vue.options={}, child: mixin = { created: fn }\r\nexport function mergeOptions(parent, child) {\r\n  const options = {}\r\n  for (let key in parent) {\r\n    mergeField(key)\r\n  }\r\n\r\n  // 儿子有,父亲没有, 把儿子多的属性合并到父亲上\r\n  for (let key in child) {\r\n    if (!parent.hasOwnProperty(key)) {\r\n      mergeField(key)\r\n    }\r\n  }\r\n\r\n  // 合并生命周期的钩子hook, 如created\r\n  function mergeField(key) {\r\n    if (strategy[key]) {\r\n      options[key] = strategy[key](parent[key], child[key])\r\n    } else {\r\n      options[key] = child[key]\r\n    }\r\n  }\r\n\r\n  return options\r\n}\r\n\r\n\r\nlet callbacks = []\r\nlet pending = false\r\nlet timerFunc;\r\n\r\n\r\nfunction flushCallbacks() {\r\n  while (callbacks.length) {\r\n    let cb = callbacks.shift()\r\n    cb()\r\n  }\r\n  pending = false\r\n}\r\n\r\nif (Promise) {\r\n  timerFunc = () => {\r\n    Promise.resolve().then(flushCallbacks)\r\n  }\r\n} else if (MutationObserver) {\r\n  let observe = new MutationObserver(flushCallbacks)\r\n  let textNode = document.createTextNode(1)\r\n  observe.observe(textNode, { characterData: true })\r\n  timerFunc = () => {\r\n    textNode.textContent = 2;\r\n  }\r\n} else if (setImmediate) {\r\n  timerFunc = () => {\r\n    setImmediate(flushCallbacks)\r\n  }\r\n} else {\r\n  timerFunc = () => {\r\n    setTimeout(flushCallbacks)\r\n  }\r\n}\r\n\r\n\r\n\r\n// watcher.js: queueWatcher中调用\r\n// 参数cb: 传入一个刷新watcher队列的函数\r\nexport function nextTick(cb) {\r\n  callbacks.push(cb)\r\n  if (!pending) {\r\n    timerFunc()\r\n    pending = true\r\n  }\r\n}","let id = 0\r\nclass Dep {\r\n  constructor() {\r\n    this.subs = []\r\n    this.id = id++\r\n  }\r\n\r\n  depend() {\r\n    // this.subs.push(Dep.target)\r\n    Dep.target.addDep(this)\r\n  }\r\n  // 给dep上添加watcher\r\n  addSub(watcher) {\r\n    this.subs.push(watcher)\r\n  }\r\n  // 数据变更, 让所有的watcher调用自己的update方法, watcher敞开方法供dep调用\r\n  notify() {\r\n    this.subs.forEach(watcher => watcher.update())\r\n  }\r\n}\r\n\r\n\r\nlet stack = []\r\n// 属性依赖dep 要记住 在哪个watcher中使用了，也就是属性在哪个组件中\r\nexport function pushTarget(watcher) {\r\n  Dep.target = watcher\r\n  stack.push(watcher)\r\n}\r\n\r\nexport function popTarget() {\r\n  // Dep.target = null\r\n  stack.pop()\r\n  // 如果栈中有多个watcher 出栈后Dep.target  要指向数组中的最后一个watcher, \r\n  Dep.target = stack[stack.length - 1]\r\n  console.log(\"stack: \", stack)\r\n}\r\n\r\n\r\nexport default Dep","import { arrayMethods } from \"./array\"\r\nimport { definePropertyWithoutEnumerable } from \"../utils\"\r\nimport Dep from \"./dep\"\r\n\r\n\r\nclass Observer {\r\n  constructor(value) {\r\n    // 记住最外层的对象\r\n    this.dep = new Dep()   // value ={}  value = [], 从data(){ return { obj, arr }} return返回的对象进行监控 其中可能是对象,也可能是数组\r\n\r\n    definePropertyWithoutEnumerable(value, '__ob__', this)  // this: Observer实例\r\n    // value.__ob__ = this\r\n\r\n    // 如果是数组, 不观测每一项\r\n    if (Array.isArray(value)) {\r\n      // value如果是数组, 继承指向重新的数组方法，通过原型链继承\r\n      value.__proto__ = arrayMethods\r\n      this.observeArray(value)\r\n    } else {\r\n      this.walk(value)\r\n    }\r\n  }\r\n\r\n  // 观测数组中的每一项, 如果是对象就进行观测\r\n  observeArray(value) {\r\n    value.forEach(item => {\r\n      // 观测数组中的对象类型\r\n      observe(item)\r\n    })\r\n  }\r\n\r\n  walk(data) {\r\n    let keys = Object.keys(data)\r\n    keys.forEach(key => {\r\n      defineReactive(data, key, data[key])\r\n    })\r\n  }\r\n}\r\n\r\n// 给每个属性添加响应式 增加dep以及watcher的处理\r\nfunction defineReactive(data, key, value) {\r\n  // 递归观察data嵌套的对象\r\n  let childDep = observe(value)  // 获取到数组对应的dep\r\n\r\n  // observe(value)\r\n\r\n  // 每个属性一个dep\r\n  let dep = new Dep()\r\n\r\n  Object.defineProperty(data, key, {\r\n    get() {\r\n      if (Dep.target) {\r\n        dep.depend()\r\n        if (childDep) {\r\n          childDep.dep.depend()\r\n        }\r\n      }\r\n      return value\r\n    },\r\n    set(newValue) {\r\n      if (newValue === value) return\r\n      console.log('数据设置了')\r\n      // 如果给data属性设置一个对象,设置的对象也需要进行观测\r\n      observe(newValue)\r\n      value = newValue\r\n\r\n      // 数据变更, 通知dep中的所有watcher调用自己的更新\r\n      dep.notify()\r\n    }\r\n  })\r\n}\r\n\r\n// 观测数据的变化, 更新视图\r\nexport function observe(data) {\r\n  if (data.__ob__) {\r\n    return data\r\n  }\r\n  // 只观测对象或数组\r\n  if (typeof data !== 'object' || data == null) {\r\n    return\r\n  }\r\n  // 使用类的方式: 1. 可以清楚的知道这个属性是哪个类的实例 2. 观测数据的功能是高内聚的\r\n  return new Observer(data)\r\n}","import { pushTarget, popTarget } from \"./dep\"\r\nimport { nextTick } from \"../utils\"\r\n\r\nlet id = 0\r\nclass Watcher {\r\n  /**\r\n   * @param {*} vm \r\n   * @param {*} exprOrFn: 可能是表达式 Vue.$set这种更新数据; 也可能是函数, 直接调用update(render)\r\n   * @param {*} updateCallback: 更新后的callback\r\n   * @param {*} options: 包含了是否为渲染watcher\r\n   */\r\n  constructor(vm, exprOrFn, updateCallback, options) {\r\n    this.vm = vm\r\n    this.exprOrFn = exprOrFn\r\n    this.updateCallback = updateCallback\r\n    this.options = options\r\n    // 如果用户定义的watch属性或者直接调用vm.$watch(expr, cb)\r\n    this.user = options.user\r\n    // computed属性\r\n    this.lazy = options.lazy; // 如果watcher上有lazy属性 说明是一个就算属性\r\n    this.dirty = this.lazy; // dirty代表取值时是否执行用户提供的方法\r\n\r\n    this.deps = []\r\n    this.depsId = new Set()\r\n    this.id = id++\r\n    // watcher内部组件渲染或者更新都是render函数\r\n    if (typeof exprOrFn === 'function') {\r\n      this.getter = exprOrFn\r\n    } else {\r\n      // 用户自定义的watcher, 如watch: {a: fn}, vm.$watch(exprOrFn,handler,options) 中,exprOrFn通常是字符串(属性key值)\r\n      this.getter = function () {\r\n        let obj = vm\r\n        let path = exprOrFn.split('.')\r\n        for (let i = 0; i < path.length; i++) {\r\n          obj = obj[path[i]]\r\n        }\r\n        return obj\r\n      }\r\n    }\r\n    // 渲染watcher和watch中的watch默认都是会执行一次的, 当时computed的watcher是默认不执行的\r\n    this.value = this.lazy ? void 0 : this.get()\r\n    // this.value = this.get()\r\n  }\r\n\r\n  // watcher记录dep，去重\r\n  addDep(dep) {\r\n    // this.deps.push(dep)\r\n    let id = dep.id\r\n    if (!this.depsId.has(id)) {\r\n      this.deps.push(dep)\r\n      this.depsId.add(id)\r\n      dep.addSub(this)\r\n    }\r\n  }\r\n\r\n  get() {\r\n    pushTarget(this)    // 把watcher实例给到Dep类去折腾. 在Dep.target = this\r\n    // 渲染页面(1. 代码生成render 2. 生成DOM,挂载页面)\r\n    let result = this.getter.call(this.vm)\r\n    popTarget()\r\n    return result\r\n  }\r\n\r\n  update() {\r\n    if (this.lazy) {\r\n      this.dirty = true // 设置为true表示需要更新\r\n    } else {\r\n      // this.get()\r\n      queueWatcher(this)\r\n    }\r\n  }\r\n\r\n  // 执行每个watcher\r\n  run() {\r\n    let oldValue = this.value\r\n    let newValue = this.get()\r\n    this.value = newValue\r\n    if (this.user) {\r\n      this.updateCallback.call(this.vm, newValue, oldValue)\r\n    }\r\n  }\r\n\r\n  // 计算属性取值\r\n  evaluate() {\r\n    // 调用get, get方法有返回值result,取值当然有返回值\r\n    this.value = this.get()\r\n    this.dirty = false    // 取了一次值, 就不是dirty的了\r\n  }\r\n\r\n  depend() {\r\n    // 拿出当前watcher的所有依赖项\r\n    let i = this.deps.length;\r\n    while (i--) {\r\n      // 让每一个dep记录当前的渲染watcher\r\n      this.deps[i].depend()\r\n    }\r\n  }\r\n}\r\n\r\n// 将需要批量更新的watcher存到一个队列中，稍后让watcher执行，存储watcher队列如果是同一个就不再存储了\r\nlet queue = []\r\nlet has = {}\r\nlet pending = false\r\n\r\n// 刷新当前调度的队列，提出一层，然后queueWatcher中就不要写定时器了\r\nfunction flushSchedulerQueue() {\r\n  // 执行watcher队列 去重后的watcher队列\r\n  queue.forEach(watcher => {\r\n    watcher.run()\r\n    // 如果不是用户watcher, 即如果是渲染watcher, 就执行cb\r\n    if (!watcher.user) {\r\n      console.log(\"render watcher cb:\", watcher.cb)\r\n      watcher.updateCallback()\r\n    } else {\r\n      console.log(\"user watcher.cb:\", watcher.cb)\r\n    }\r\n  })\r\n  // 执行完之后清空队列 准备下一次watcher队列的更新\r\n  queue = []\r\n  has = {}\r\n  pending = false\r\n}\r\n\r\n\r\n\r\n// 更新队列\r\nfunction queueWatcher(watcher) {\r\n  const id = watcher.id\r\n  if (!has[id]) {\r\n    queue.push(watcher)\r\n    has[id] = true\r\n    if (!pending) {\r\n      // setTimeout(() => {\r\n      //   queue.forEach(watcher => watcher.run())  // 清空队列\r\n      //   queue = []\r\n      //   has = {}\r\n      //   pending = false\r\n      // }, 0);\r\n      nextTick(flushSchedulerQueue)\r\n      pending = true\r\n    }\r\n  }\r\n}\r\n\r\nexport default Watcher","import { observe } from \"./observer/index.js\"\r\nimport { proxy, nextTick } from \"./utils.js\"\r\nimport Watcher from \"./observer/watcher.js\"\r\nimport Dep from \"./observer/dep.js\"\r\n\r\nexport function initState(vm) {\r\n  const opts = vm.$options\r\n  // 根据不同的选项, 做不同的拆分处理, data如何处理, props如何处理等\r\n  if (opts.props) {\r\n    initProps(vm)\r\n  }\r\n  if (opts.data) {\r\n    initData(vm)\r\n  }\r\n  if (opts.watch) {\r\n    initWatch(vm)\r\n  }\r\n  if (opts.computed) {\r\n    initComputed(vm)\r\n  }\r\n}\r\n\r\n// data数据的初始化操作, 数据劫持\r\nfunction initData(vm) {\r\n  let data = vm.$options.data\r\n  // data可能是函数, 也可能是对象, 函数就直接执行,结果返回对象,赋值给vm也是为了可以通过vue实例获取到数据劫持后的数据(引用)\r\n  vm._data = data = typeof data === 'function' ? data.call(vm) : data\r\n\r\n  // 当我去vm上取属性时 ，帮我将属性的取值代理到vm._data上\r\n  for (let key in data) {\r\n    proxy(vm, '_data', key)\r\n  }\r\n  observe(data)\r\n}\r\n\r\nfunction initProps() { }\r\n\r\n// watch属性对象的作用就是数据属性变化了，执行watch监控的对应方法或者数组方法\r\nfunction initWatch(vm) {\r\n  let watches = vm.$options.watch\r\n  for (let key in watches) {\r\n    const handler = watches[key]\r\n    if (Array.isArray(handler)) {\r\n      handler.forEach(handle => createWatcher(vm, key, handle))\r\n    } else {\r\n      createWatcher(vm, key, handler)\r\n    }\r\n  }\r\n}\r\n\r\n// 大部分情况下exprOrFn是watch中监控的属性名, 字符串, cb可能是函数，对象，字符串\r\nfunction createWatcher(vm, exprOrFn, handler, options) {\r\n  // console.log(exprOrFn, cb, options)\r\n  if (typeof handler === 'object') {       // a: { handler () {...,deep, immediate: true, ...}}\r\n    options = handler     // 把整个对象的配置都给options\r\n    handler = handler.handler // 把执行的函数拿出来\r\n  }\r\n  if (typeof handler === 'string') {\r\n    handler = vm[handler]   // method中的方法\r\n  }\r\n  // 其他都是key:fn\r\n  // return new Watcher(vm, exprOrFn, handler, options)\r\n  return vm.$watch(exprOrFn, handler, options)\r\n}\r\n\r\nfunction initComputed(vm) {\r\n  const computed = vm.$options.computed\r\n  const watchers = vm._computedWatchers = {}\r\n  // debugger\r\n  // 因为依赖的属性变更，计算属性要重新执行, 有依赖收集的功能, 内部实现了watcher，所以要重写computed的每一个属性,\r\n  // 并且将属性改在到vm实例上，可以让组件通过this.计算属性获的形式 获取到这个值\r\n  for (let key in computed) {\r\n    const userDef = computed[key]     // 两种计算属性的写法 1. 函数 2. 对象\r\n    // 获取get方法, 用于传递给watcher的 get属性, 即属性发生变更执行的函数\r\n    const getter = typeof userDef == 'function' ? userDef : userDef.get;\r\n    // 给每个计算属性增加一个watcher,保存的vm实例变量_computedWatchers上, watcers['fullName'] = watcher\r\n    // 并且标识一下当前的watcher的类型是计算属性，是lazy的\r\n    watchers[key] = new Watcher(vm, getter, () => { }, { lazy: true })\r\n    defineComputed(vm, key, userDef)\r\n  }\r\n}\r\n\r\n\r\n\r\n// 这里没有写vm而是target表示的是: 可能是给Vue的实例挂属性, 也可能给组件实例挂属性\r\n// 入参:userDef 可能是函数 或者是对象;如果是函数,处理成对象的形式. 定义sharedComputedProperty为对象,给对象增加get,set属性\r\nfunction defineComputed(target, key, userDef) {\r\n  const sharedComputedProperty = {}\r\n  if (typeof userDef == 'function') {\r\n    sharedComputedProperty.get = createComputedGetter(key)      // 调用get,就是执行usefDef函数\r\n  } else {\r\n    sharedComputedProperty.get = createComputedGetter(key)\r\n    sharedComputedProperty.set = userDef.set\r\n  }\r\n  Object.defineProperty(target, key, sharedComputedProperty)\r\n}\r\n\r\n\r\n// 此方法是我们包装的方法，每次取值会调用此方法\r\nfunction createComputedGetter(key) {\r\n  // 取值时才会调用\r\n  return function () {\r\n    const watcher = this._computedWatchers[key] // 拿到这个属性对应的watcher\r\n    if (watcher) {\r\n      if (watcher.dirty) {    // 默认肯定是脏的，Watcher类初始化为true.\r\n        watcher.evaluate()    // 对当前watcher求值\r\n        // return watcher.value\r\n      }\r\n      // \r\n      if (Dep.target) { // 说明还有渲染watcher，也应该一并的收集起来\r\n        watcher.depend()\r\n      }\r\n      // 如果不是dirty的，说明是新的，赶紧的，直接返回\r\n      return watcher.value\r\n    }\r\n  }\r\n}\r\n\r\n\r\nexport function stateMixin(Vue) {\r\n  // 用户自定义cb,默认调用util中的nextTick, 共用同调用同一个\r\n  Vue.prototype.$nextTick = function (cb) {\r\n    nextTick(cb)\r\n  }\r\n  Vue.prototype.$watch = function (exprOrFn, cb, options) {\r\n    let watcher = new Watcher(this, exprOrFn, cb, { ...options, user: true })\r\n    if (options.immediate) {\r\n      cb()\r\n    }\r\n  }\r\n}","const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`; // 标签名 ?:匹配不捕获\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`; // </my:xx>\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`); // 标签开头的正则 捕获的内容是标签名\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`); // 匹配标签结尾的 </div>\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/; // 匹配属性的    aaa=\"aaa\"  a='aaa'   a=aaa\r\nconst startTagClose = /^\\s*(\\/?)>/; // 匹配标签结束的 >    >   <div></div>  <br/>\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;\r\n\r\nexport function parseHTML(html) {\r\n  // 解析开始标签 <div id=\"app\" name=\"xxx\">\r\n  function parseStartTag() {\r\n    const start = html.match(startTagOpen)\r\n    // start[0] => \"<div\"\r\n    if (start) {\r\n      // 保存标签和属性\r\n      const match = {\r\n        tagName: start[1],      // start[1] ==> div\r\n        attrs: []\r\n      }\r\n      // 匹配完了就要删除\r\n      advance(start[0].length)   // 删除html开始标签 start[0] ==> <div\r\n\r\n      let end, attr\r\n      // 处理开始标签的属性 如果没有遇到结束标签的标识符\">\", 并且匹配到了属性, 就将匹配到的attr保存到match对象上, 最终return\r\n      while (!(end = html.match(startTagClose)) && (attr = html.match(attribute))) {\r\n        match.attrs.push({\r\n          name: attr[1],      // id\r\n          value: attr[3] || attr[4] || attr[5]    // app\r\n        })\r\n        // 匹配完继续删除\r\n        advance(attr[0].length)\r\n      }\r\n      // 最终就剩下 \">\"\r\n      if (end) {\r\n        advance(end[0].length)\r\n        return match\r\n      }\r\n    }\r\n  }\r\n\r\n  function advance(n) {\r\n    html = html.substring(n)\r\n  }\r\n\r\n  let root;\r\n  let currentParent;    // 父节点\r\n  let stack = []        // 用于校验html标签书写是否规范, 标签是否配对, 开始标签存入栈中, 遇到结束标签 pop, \r\n\r\n  // 处理开始\r\n  function start(tagName, attrs) {\r\n    // console.log(tagName, attrs)\r\n    let element = createASTElement(tagName, attrs)\r\n    // 因为创建的是树tree,只能由一个根root\r\n    if (!root) {\r\n      root = element\r\n    }\r\n    currentParent = element   // 解析的当前节点作为 下一次解析文本的父级元素 例如 <div id=\"app\">hello</div>, <div id=\"app\">生成的 AST对象就是hello的父级currentParent\r\n    stack.push(element)\r\n    // console.log(\"stack: \", stack)\r\n  }\r\n\r\n  // 处理文本\r\n  function chars(text) {\r\n    // console.log(text)\r\n    // 文本可能是空文本\r\n    // text = text.replace(/\\s/g, '')\r\n    text = text.trim()\r\n    if (text) {\r\n      currentParent.children.push({\r\n        type: 3,\r\n        text\r\n      })\r\n    }\r\n  }\r\n\r\n  // 结束标签处理 </div>\r\n  // 1. 记录结束标签的父亲\r\n  // 2. 当前标签父亲的儿子是谁\r\n  // 3. 结束标签建立父子关系 \r\n  function end(tagName) {\r\n    // console.log(\"end....\", tagName)\r\n    let ele = stack.pop()   // 取出栈中的最后一个\r\n    // console.log(\"ele,\", ele)\r\n    // if (tagName === ele.tag) {\r\n    //   console.log('tagName,  ele.tagName', tagName, ele.tag)\r\n    // } else {\r\n    //   console.log('------> tagName,  ele.tagName', tagName, ele.tag)\r\n    // }\r\n    currentParent = stack[stack.length - 1]\r\n    if (currentParent) {\r\n      ele.parent = currentParent\r\n      currentParent.children.push(ele)\r\n    }\r\n  }\r\n\r\n  // 生成AST\r\n  function createASTElement(tagName, attrs) {\r\n    return {\r\n      tag: tagName, // 标签名\r\n      type: 1, // 元素类型\r\n      children: [], // 孩子列表\r\n      attrs, // 属性集合\r\n      parent: null // 父元素\r\n    }\r\n  }\r\n\r\n\r\n  while (html) {\r\n    // debugger\r\n    // 查找到 \"<\"\r\n    let textEnd = html.indexOf('<')\r\n    if (textEnd == 0) {   // 肯定是标签, 要么是<div> 开始标签, 要么是结束标签</div>\r\n      // 解析匹配开始标签\r\n      const startTagMatch = parseStartTag()\r\n      if (startTagMatch) {\r\n        start(startTagMatch.tagName, startTagMatch.attrs)   // start函数内调用创建ast树的方法\r\n        // 继续处理(处理文本或者结束标签)\r\n        continue\r\n      }\r\n      // 匹配上 < 也可能是结束标签, 此处用html.match, 因为html已经在上面的parseStartTag中,如果匹配了就已经截取删除了\r\n      // 如果是结束标签, \r\n      const endTagMatch = html.match(endTag)\r\n      if (endTagMatch) {\r\n        advance(endTagMatch[0].length)      // <div>\r\n        end(endTagMatch[1])    // 将结束标签传入 \r\n        continue\r\n      }\r\n    }\r\n    // 如果是文本保存并\r\n    let text\r\n    if (textEnd > 0) {\r\n      text = html.substring(0, textEnd)\r\n    }\r\n    // 截取删除\r\n    if (text) {\r\n      advance(text.length)\r\n      chars(text)     // 处理文本 hello {{name}}\r\n    }\r\n    // break;\r\n  }\r\n\r\n  return root;\r\n}","\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;\r\n\r\nfunction genProps(attrs) {\r\n  let str = ''\r\n  for (let i = 0; i < attrs.length; i++) {\r\n    const attr = attrs[i];\r\n    if (attr.name === 'style') {\r\n      let obj = {}\r\n      attr.value.split(';').forEach(_item => {\r\n        let [key, value] = _item.split(':')\r\n        obj[key] = value\r\n      })\r\n      attr.value = obj\r\n    }\r\n    str += `${attr.name}:${JSON.stringify(attr.value)},`\r\n  }\r\n  return `{${str.slice(0, -1)}}`\r\n  // _c(div, {id:\"app\",style:{\"color\":\"red\",\" fontSize\":\" 16px\"}})\r\n}\r\n\r\n\r\nfunction gen(node) {\r\n  if (node.type === 1) {\r\n    return generate(node)   // 生产元素节点的字符串\r\n  } else {\r\n    let text = node.text\r\n    if (!defaultTagRE.test(text)) {\r\n      return `_v(${JSON.stringify(text)})`\r\n    }\r\n    let tokens = []\r\n    let lastIndex = defaultTagRE.lastIndex = 0\r\n    let match, index\r\n\r\n    while (match = defaultTagRE.exec(text)) {\r\n      index = match.index\r\n      if (index > lastIndex) {\r\n        tokens.push(JSON.stringify(text.slice(lastIndex, index)))   // 匹配开始的下表 截取匹配字符串的长度\r\n      }\r\n      // 匹配变量\r\n      tokens.push(`_s(${match[1].trim()})`)\r\n      lastIndex = index + match[0].length\r\n    }\r\n    // 如果是这种情况 hello {{name}} world {{age}} xxx, 需要把xxx加入到token中, 作为_v\r\n    if (lastIndex < text.length) {\r\n      tokens.push(JSON.stringify(text.slice(lastIndex)))\r\n    }\r\n    return `_v(${tokens.join('+')})`;\r\n  }\r\n}\r\n\r\nfunction genChildren(ast) {\r\n  const children = ast.children\r\n  if (children) {\r\n    return children.map(child => gen(child)).join(',')\r\n  }\r\n}\r\n\r\nexport function generate(ast) {\r\n  let children = genChildren(ast)  // 生成儿子\r\n  // `,${children}` 前面的, 要注意细节\r\n  let code = `_c('${ast.tag}', ${ast.attrs.length > 0 ? `${genProps(ast.attrs)}` : 'undefined'} ${children ? `,${children}` : ''})`\r\n  // console.log(\"code: \", code)\r\n  return code\r\n}","import { parseHTML } from \"./parse\";\r\nimport { generate } from \"./generate\";\r\n\r\nexport function compileToFunctions(template) {\r\n  // 将模板字符串解析成AST语法树\r\n  let ast = parseHTML(template)\r\n  // 静态代码优化\r\n  // 代码生成: 根据ast树生成render方法\r\n  let code = generate(ast)\r\n  let render = new Function(`with(this) { return ${code}}`)\r\n  // 将字符串变成函数 限制取值范围 通过with来进行取值 稍后调用render函数就可以通过改变this 让这个函数内部取到结果了\r\n  // let render = new Function(`with(this) { return ${code} }`)\r\n  return render\r\n}","// 返回值是真实DOM, 调用处lifecycle.js中 赋值给了vue实例的$el属性上，保存着DOM\r\nexport function patch(oldVNode, vnode) {\r\n  // ------------------- 处理初渲染流程，直接用初始VDOM 替换掉 原始DOM节点(#app)\r\n  // 默认初始化时，时直接用虚拟节点创建出真实的DOM节点，替换掉老的DOM节点\r\n  if (oldVNode.nodeType === 1) { // html dom 固有的属性, =1 表示是元素\r\n    // debugger\r\n    let el = createElm(vnode)   // 产生真实的dom \r\n    let parentElement = oldVNode.parentNode;  // 获取老的app的父亲 =》 body\r\n    parentElement.insertBefore(el, oldVNode.nextSibling) // 当前的真实元素插入到app的后面\r\n    parentElement.removeChild(oldVNode) // 删除老的节点\r\n    return el // 把创建的DOM返回\r\n  } else {\r\n    // ------------------- 处理更新流程, 两个虚拟DOM的比较 -------------------\r\n    // 在更新时，拿老的虚拟节点 和 新的虚拟节点进行比较，将差异更新为真实的DOM\r\n\r\n    // 1. 比较标签\r\n    if (oldVNode.tag !== vnode.tag) {\r\n      return oldVNode.el.parentNode.replaceChild(createElm(vnode), oldVNode.el)\r\n    }\r\n\r\n    // 2. 比较文本(因为文本的tag是undefined, 走到这里说明新老tag是一样相等的)\r\n    // 标签一样，标签没有子元素，标签只有文本, 文本不同时的处理 <div>1</div>  <div>2</div>\r\n    if (!oldVNode.tag) {\r\n      // 如果文本不一致, 用vnode的text属性值更新 老的虚拟DOM上的el属性所代表的老的DOM节点的文本内容\r\n      if (oldVNode.text !== vnode.text) {\r\n        return oldVNode.el.textContent = vnode.text\r\n      }\r\n    }\r\n\r\n    // 3. 对比属性: 标签相同, 复用老节点，然后 比较标签的属性\r\n    // 3.1 复用老节点，给新的虚拟node添加el属性\r\n    let el = vnode.el = oldVNode.el\r\n    // 3.2 比较属性并更新. 使用新的vnode作为参数, 原因是要把其作为整体传递过去, 要使用到最新的DOM节点的标签元素 el\r\n    updateProperties(vnode, oldVNode.data)\r\n\r\n    // 4. 对比儿子\r\n    let oldChildren = oldVNode.children || []   // 也是虚拟DOM\r\n    let newChildren = vnode.children || []\r\n\r\n    if (oldChildren.length > 0 && newChildren.length > 0) {\r\n      // 更新儿子节点, 两个虚拟节点的儿子数组, dom元素\r\n      updateChildren(oldChildren, newChildren, el)\r\n    } else if (oldChildren.length > 0) { // 老的有儿子，新的没有儿子\r\n      el.innerHTML = ''\r\n    } else if (newChildren.length > 0) { // 新的有儿子，老的没有 => 创建并插入节点\r\n      for (let i = 0; i < newChildren.length; i++) {\r\n        // 浏览器有性能优化 不用自己在搞文档碎片了\r\n        el.appendChild(createElm(newChildren[i]))\r\n      }\r\n    }\r\n\r\n\r\n  }\r\n}\r\n\r\n// 比较两个vnode, 相同元素 + key\r\nfunction isSameVNode(oldVnode, newVnode) {\r\n  return (oldVnode.tag === newVnode.tag) && (oldVnode.key == newVnode.key)\r\n}\r\n\r\n// \r\nfunction updateChildren(oldChildren, newChildren, parent) {\r\n  // 老的vnode\r\n  let oldStartIndex = 0;\r\n  let oldStartVnode = oldChildren[0]\r\n  let oldEndIndex = oldChildren.length - 1\r\n  let oldEndVnode = oldChildren[oldEndIndex]\r\n\r\n  // 新的vnode\r\n  let newStartIndex = 0;\r\n  let newStartVnode = newChildren[0]\r\n  let newEndIndex = newChildren.length - 1\r\n  let newEndVnode = newChildren[newEndIndex]\r\n\r\n  // 生成key-index的映射表\r\n  function makeIndexByKey(children) {\r\n    let map = {}\r\n    children.forEach((child, index) => {\r\n      if (child.key) {\r\n        map[child.key] = index\r\n      }\r\n    })\r\n    return map\r\n  }\r\n  let map = makeIndexByKey(oldChildren)\r\n\r\n\r\n  // 遍历两个数组 包含着虚拟节点, 只要一个循环完, 就结束\r\n  while (oldStartIndex <= oldEndIndex && newStartIndex <= newEndIndex) {\r\n    // 如果老的数组中的元素是null\r\n    if (oldStartVnode == null) {\r\n      oldStartVnode = oldChildren[++oldStartIndex]\r\n    }\r\n    // 从头向尾 遍历比较\r\n    if (isSameVNode(oldStartVnode, newStartVnode)) {\r\n      // 如果tag相同, 更新属性, 指针向后移动一个\r\n      patch(oldStartVnode, newStartVnode)\r\n      oldStartVnode = oldChildren[++oldStartIndex]\r\n      newStartVnode = newChildren[++newStartIndex]\r\n    } else if (isSameVNode(oldEndVnode, newEndVnode)) {\r\n      // 从头到尾对比失败, 就从后向前比较\r\n      patch(oldEndVnode, newEndVnode)\r\n      oldEndVnode = oldChildren[--oldEndIndex]\r\n      newEndVnode = newChildren[--newEndIndex]\r\n    } else if (isSameVNode(oldStartVnode, newEndVnode)) {\r\n      // 3. 老的头元素 与 新的 尾部 比较\r\n      patch(oldStartVnode, newEndVnode)\r\n      parent.insertBefore(oldStartVnode.el, oldEndVnode.el.nextSibling)\r\n      oldStartVnode = oldChildren[++oldStartIndex]\r\n      newEndVnode = newChildren[--newEndIndex]\r\n    } else if (isSameVNode(oldEndVnode, newStartVnode)) {\r\n      // 4. 老的尾 和 新的头\r\n      patch(oldEndVnode, newStartVnode)\r\n      parent.insertBefore(oldEndVnode.el, oldStartVnode.el)\r\n      oldEndVnode = oldChildren[--oldEndIndex]\r\n      newStartVnode = newChildren[++newStartIndex]\r\n    } else {\r\n      // 儿子之间没有关系, 用新的数组去查找映射关系\r\n      // 1. 从新的数组中一个个查找, 找到新数组中的元素在老的数组中的索引位置\r\n      let findIndex = map[newStartVnode.key]\r\n      // 2. 如果没有找到, 就是新增的, 插入到老的开始节点的前面\r\n      if (findIndex == undefined) {\r\n        parent.insertBefore(createElm(newStartVnode), oldStartVnode.el)\r\n      } else {\r\n        let findVNode = oldChildren[findIndex]    // 通过mapping的索引，找到老的虚拟节点的元素\r\n        patch(findVNode, newStartVnode) // 比较老的和新的VDOM的属性和儿子   递归\r\n        parent.insertBefore(findVNode.el, oldStartVnode.el) // 将查找并更新后的节点 findVNode DOM节点el 插入到老数组的开始指针索引的前面\r\n        oldChildren[findIndex] = null   // 设置根据索引查找的移动的节点 为null, 避免数组塌陷\r\n      }\r\n      newStartVnode = newChildren[++newStartIndex]    // 新数组指针向后移动,并更新数组的开始节点 newStartVnode\r\n    }\r\n  }\r\n\r\n  // 处理比较完成后有多余的\r\n\r\n  // 如果新的多于老的, 并且在最后多的\r\n  if (newStartIndex <= newEndIndex) {\r\n    for (let i = newStartIndex; i <= newEndIndex; i++) {\r\n      parent.appendChild(createElm(newChildren[newStartIndex]))\r\n    }\r\n  }\r\n\r\n  // 如果老的数组还没有遍历完成, 老节点是不需要的节点,\r\n  if (oldStartIndex <= oldEndIndex) {\r\n    for (let i = oldStartIndex; i <= oldEndIndex; i++) {\r\n      let child = oldChildren[i]\r\n      if (child != null) {\r\n        parent.removeChild(child.el)\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\n\r\n\r\nexport function createElm(vnode) {\r\n  let { tag, children, key, data, text } = vnode;\r\n  if (typeof tag == 'string') { // 创建元素 放到vnode.el上\r\n    // 创建DOM\r\n    vnode.el = document.createElement(tag);\r\n    // 更新属性\r\n    updateProperties(vnode)\r\n\r\n    children.forEach(child => { // 遍历儿子 将儿子渲染后的结果扔到父亲中\r\n      vnode.el.appendChild(createElm(child));\r\n    })\r\n  } else { // 创建文件 放到vnode.el上\r\n    vnode.el = document.createTextNode(text);\r\n  }\r\n  return vnode.el;\r\n}\r\n\r\n// 根据虚拟节点的data属性, 更新DOM的attrs\r\nfunction updateProperties(vnode, oldProps = {}) {\r\n  let el = vnode.el\r\n  let newProps = vnode.data || {}\r\n  // 老的有，新的没有 -> 删除\r\n  for (let key in oldProps) {  // oldProps: {id: 'a', name: 'input'}\r\n    if (!newProps[key]) {     // newProps: {xx: 'yy'}\r\n      el.removeAttribute(key)  // 当前的el就是复用后的el\r\n    }\r\n  }\r\n\r\n  // 剩下的就是属性在 老的和新的都有, 或者新的有\r\n  // 因为样式的写法是对象方式,单独处理\r\n  let newStyle = newProps.style || {}\r\n  let oldStyle = oldProps.style || {}\r\n  for (let key in oldStyle) {\r\n    if (!newStyle[key]) {\r\n      el.style[key] = ''\r\n    }\r\n  }\r\n\r\n  // 1. 新的有，老的有；替换\r\n  // 2. 新的有，老的没有；新增设置\r\n  for (let key in newProps) {\r\n    if (key === 'style') {\r\n      // style属性是个对象\r\n      for (let styleName in newProps.style) {\r\n        el.style[styleName] = newProps.style[styleName]\r\n      }\r\n    } else if (key === 'class') {\r\n      el.className = newProps.class\r\n    } else {\r\n      // 新的有，老的没有，直接增加\r\n      el.setAttribute(key, newProps[key])\r\n    }\r\n  }\r\n}\r\n\r\n\r\n\r\n// 初渲染属性(创建)\r\n/* function updateProperties(vnode) {\r\n  let el = vnode.el\r\n  let newProps = vnode.data || {}\r\n  for (let key in newProps) {\r\n    if (key === 'style') {\r\n      // style属性是个对象\r\n      for (let styleName in newProps.style) {\r\n        el.style[styleName] = newProps.style[styleName]\r\n      }\r\n    } else if (key === 'class') {\r\n      el.className = el.class\r\n    } else {\r\n      el.setAttribute(key, newProps[key])\r\n    }\r\n  }\r\n} */","// 生命周期也是一个插件, 需要在Vue实例的原型上挂载更新与render方法\r\n\r\nimport { patch } from \"./vdom/patch\"\r\nimport Watcher from \"./observer/watcher\"\r\n\r\nexport function mountComponent(vm, el) {\r\n  callHook(vm, 'beforeMount')\r\n  // 1. 生成虚拟DOM => vm._render() 2. 渲染真实节点vm._update\r\n  // 都是vm实例上的方法, render和update都是组件生命周期的一部分, 抽离成一个lifecycle文件转换处理生命周期, 理念上与初始化平级别 init - lifecycle\r\n  // vm._update(vm._render())\r\n  const updateComponent = () => {\r\n    vm._update(vm._render())\r\n  }\r\n  const updateCallback = () => { }\r\n  const isRenderWatcher = true\r\n\r\n  let watcher = new Watcher(vm, updateComponent, updateCallback, isRenderWatcher)\r\n\r\n  callHook(vm, 'mounted')\r\n}\r\n\r\nexport function lifecycleMixin(Vue) {\r\n  // 渲染页面\r\n  Vue.prototype._update = function (vnode) {\r\n    const vm = this\r\n    const preVnode = vm._vnode\r\n    if (!preVnode) {\r\n      vm.$el = patch(vm.$el, vnode) // 新的vdom, 生成新的DOM, 替换掉老的DOM vm.$el, 然后返回这个新的DOM, 赋值给实例属性上 vm.$el\r\n\r\n    } else {\r\n      vm.$el = patch(preVnode, vnode)\r\n    }\r\n    vm._vnode = vnode\r\n  }\r\n  // 生成虚拟DOM\r\n  Vue.prototype._render = function () {\r\n    const vm = this\r\n    let render = vm.$options.render\r\n    // 调用vm.$options.render方法, new Function(`with(this) { return ${code}}`)\r\n    // 因为render方法的字符串表示中有类似 _c, _v这种函数调用, 作用域(通过with)指向了this, call(vm), 那么this就是vm. 实例上的方法, 原型方法, \r\n    let vdom = render.call(vm)\r\n    // console.log(\"vdom,\", vdom)\r\n    return vdom\r\n  }\r\n}\r\n\r\nexport function callHook(vm, hook) {\r\n  const handlers = vm.$options[hook]    // vm.$options[hook] = vm.$options.created = [a,b,created,...]\r\n  if (handlers) {\r\n    for (let i = 0; i < handlers.length; i++) {\r\n      handlers[i].call(vm)\r\n    }\r\n  }\r\n}","import { initState } from \"./state\"\r\nimport { compileToFunctions } from \"./compiler/index.js\"\r\nimport { mountComponent, callHook } from './lifecycle'\r\nimport { mergeOptions } from \"./utils\"\r\n\r\n// 初始化\r\nexport function initMixin(Vue) {\r\n  Vue.prototype._init = function (options) {\r\n    // 选项挂载到vue实例上\r\n    const vm = this\r\n    vm.$options = mergeOptions(vm.constructor.options, options)\r\n    // console.log(vm.$options)\r\n\r\n    callHook(vm, 'beforeCreate')\r\n    // 初始化中一个个不同的功能\r\n    // 1. 数据的初始化: 初始化状态, 数据响应式, 数据变更, 视图更新, 数据劫持\r\n    initState(vm)\r\n\r\n    callHook(vm, 'created')\r\n    // 2. 初始化事件\r\n    // 3. 数据渲染到页面\r\n    // 如果有el属性, 说明需要渲染页面\r\n    if (vm.$options.el) {\r\n      vm.$mount(vm.$options.el)\r\n    }\r\n  }\r\n\r\n  Vue.prototype.$mount = function (el) {\r\n    const vm = this\r\n    el = document.querySelector(el)\r\n    vm.$el = el\r\n    const options = vm.$options\r\n    if (!options.render) {\r\n      let template = options.template\r\n      if (!template && el) {\r\n        template = el.outerHTML\r\n      }\r\n      // 将模板编译成render函数\r\n      const render = compileToFunctions(template)\r\n      options.render = render\r\n    }\r\n    // 挂载组件 属于生命周期的一部分 (创建VDOM和渲染真实节点的开始 vm上有render, el是被替换的DOM节点)\r\n    // debugger\r\n    mountComponent(vm, el)\r\n  }\r\n}","export function renderMixin(Vue) {\r\n  // 生成虚拟DOM\r\n  // _c(div, {id:\"app\",style:{\"color\":\"red\"}} ,_c(p, undefined ,_v(\"hello world zf\"+_s(school.name))))\r\n  Vue.prototype._c = function () {  // 创建虚拟dom元素\r\n    return createElement(...arguments)\r\n  }\r\n\r\n  // 创建虚拟dom文本元素\r\n  Vue.prototype._v = function (text) {\r\n    return createTextVnode(text);\r\n  }\r\n  // stringify\r\n  Vue.prototype._s = function (val) {\r\n    // console.log('_s: val', val, typeof val)\r\n    return val === null ? '' : typeof val === 'object' ? JSON.stringify(val) : val\r\n  }\r\n}\r\n\r\n// 其实还是根据ast对象树 生成vdom\r\nfunction createElement(tag, data = {}, ...children) {\r\n  return vnode(tag, data, data.key, children)\r\n}\r\n\r\nfunction createTextVnode(text) {\r\n  return vnode(undefined, undefined, undefined, undefined, text)\r\n}\r\n\r\n// 用来产生虚拟dom的\r\nfunction vnode(tag, data, key, children, text) {\r\n  return {\r\n    tag, data, key, children, text\r\n  }\r\n}","import { mergeOptions } from \"../utils\"\r\n\r\nexport function initGlobalApi(Vue) {\r\n  Vue.options = {}\r\n  Vue.mixin = function (mixin) {\r\n    // debugger\r\n    this.options = mergeOptions(this.options, mixin)\r\n  }\r\n}","import { initMixin } from \"./init\"\r\nimport { lifecycleMixin } from \"./lifecycle\"\r\nimport { renderMixin } from \"./vdom/index\"\r\nimport { initGlobalApi } from \"./global-api/index\"\r\nimport { stateMixin } from \"./state\"\r\n\r\n\r\nfunction Vue(options) {\r\n  this._init(options)\r\n}\r\n\r\n// 扩展原型\r\n// 初始化方法\r\ninitMixin(Vue)\r\nlifecycleMixin(Vue)\r\nrenderMixin(Vue)\r\nstateMixin(Vue)\r\n// 扩展Vue静态方法\r\ninitGlobalApi(Vue)\r\n\r\nexport default Vue\r\n\r\n\r\n\r\n"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","result","apply","arguments","inserted","ob","__ob__","slice","observeArray","dep","notify","proxy","vm","data","key","defineProperty","get","set","newValue","definePropertyWithoutEnumerable","target","value","enumerable","configurable","LIFECYCLE_HOOKS","strategy","mergeHook","parentVal","childVal","concat","hook","mergeOptions","parent","child","options","mergeField","hasOwnProperty","callbacks","pending","timerFunc","flushCallbacks","length","cb","shift","Promise","resolve","then","MutationObserver","observe","textNode","document","createTextNode","characterData","textContent","setImmediate","setTimeout","nextTick","push","id","Dep","subs","addDep","watcher","update","stack","pushTarget","popTarget","pop","console","log","Observer","isArray","__proto__","walk","item","keys","defineReactive","childDep","depend","Watcher","exprOrFn","updateCallback","user","lazy","dirty","deps","depsId","Set","getter","obj","path","split","i","has","add","addSub","call","queueWatcher","oldValue","queue","flushSchedulerQueue","run","initState","opts","$options","props","initData","watch","initWatch","computed","initComputed","_data","watches","handler","handle","createWatcher","$watch","watchers","_computedWatchers","userDef","defineComputed","sharedComputedProperty","createComputedGetter","evaluate","stateMixin","Vue","$nextTick","immediate","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","parseHTML","html","parseStartTag","start","match","tagName","attrs","advance","end","attr","name","n","substring","root","currentParent","element","createASTElement","chars","text","trim","children","type","ele","tag","textEnd","indexOf","startTagMatch","endTagMatch","defaultTagRE","genProps","str","_item","JSON","stringify","gen","node","generate","test","tokens","lastIndex","index","exec","join","genChildren","ast","map","code","compileToFunctions","template","render","Function","patch","oldVNode","vnode","nodeType","el","createElm","parentElement","parentNode","insertBefore","nextSibling","removeChild","replaceChild","updateProperties","oldChildren","newChildren","updateChildren","innerHTML","appendChild","isSameVNode","oldVnode","newVnode","oldStartIndex","oldStartVnode","oldEndIndex","oldEndVnode","newStartIndex","newStartVnode","newEndIndex","newEndVnode","makeIndexByKey","findIndex","undefined","findVNode","createElement","oldProps","newProps","removeAttribute","newStyle","style","oldStyle","styleName","className","setAttribute","mountComponent","callHook","updateComponent","_update","_render","isRenderWatcher","lifecycleMixin","preVnode","_vnode","$el","vdom","handlers","initMixin","_init","constructor","$mount","querySelector","outerHTML","renderMixin","_c","_v","createTextVnode","_s","val","initGlobalApi","mixin"],"mappings":"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"}